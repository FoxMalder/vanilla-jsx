(self.webpackChunk_vanilla_jsx_website=self.webpackChunk_vanilla_jsx_website||[]).push([[709],{709:(n,t,e)=>{"use strict";e.r(t),e.d(t,{default:()=>Z});var r=e(931),i=e(582),c=e.n(i),o=function(){return(0,r.tZ)("style",{children:"\npre {\n    padding: 32px;\n    color: #333;\n    background: #eee;\n    overflow: scroll;\n}\n"})},u=function(){return(0,r.BX)(r.HY,{children:[(0,r.tZ)("p",{children:"定义一个带状态的组件."}),(0,r.tZ)("pre",{children:(0,r.tZ)("code",{children:"\nimport Component from '@vanilla-jsx/component'\n\nconst Content = Component((props, ctx) => {\n    // 这里的代码仅在组件初始化时执行一次.\n    return () => {\n        // 这里的代码在触发 ctx.render() 时每次都执行.\n        return <div></div>\n    }\n});\n\ndocument.body.append(<Content />);\n"})})]})},p=c()((function(n,t){return function(){return(0,r.BX)(r.HY,{children:[(0,r.tZ)(o,{}),(0,r.tZ)("style",{children:"\n.event-button {\n    margin-right: 12px;\n}\n"}),(0,r.tZ)("p",{children:"操作 ctx 来 get/set state"}),(0,r.tZ)("button",{ref:function(n){n.addEventListener("click",(function(){t.num=t.num||0,t.num+=1,t.render()}))},children:"点我"})," ",t.num||"",(0,r.tZ)("pre",{children:(0,r.tZ)("code",{children:"\nconst Content = Component((props, ctx) => {\n    return () => {\n        <button ref={(button) => {\n            button.addEventListener('click', () => {\n                ctx.num = ctx.num || 0;\n                ctx.num += 1;\n                ctx.render();\n            })\n        }}>点我</button> {ctx.num || ''}\n    }\n});\n"})})]})}})),d=function(){return(0,r.BX)(r.HY,{children:[(0,r.BX)("p",{children:["组件样式默认是 scoped 的, 因为组件的根节点被设置成了 ",(0,r.tZ)("a",{href:"https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_shadow_DOM",target:"_blank",children:"Shadow Dom"})]}),(0,r.tZ)("pre",{children:(0,r.tZ)("code",{children:"\nconst Content = Component((props, ctx) => {\n    return () => {\n        return <>\n            <style>{".concat("`","\ndiv {\n    color: blue;\n}\n","`","}</style>\n            <div>I'm blue.</div>\n        </>;\n    }\n});\n\ndocument.body.append(<><Content /><div>I'm not blue.</div></>);\n")})})]})},a=function(){return(0,r.BX)(r.HY,{children:[(0,r.tZ)("h3",{children:"一个简单的路由"}),(0,r.tZ)("pre",{children:(0,r.tZ)("code",{children:"\nconst Page1 = () => <div>Page 1</div>;\nconst Page2 = () => <div>Page 2</div>;\n\nconst Root = Component((_, ctx) => {\n    window.addEventListener('hashchange', () => ctx.render());\n\n    return () => {\n        if (location.hash === '#/page2') {\n            return <Page2></Page2>;\n        } else {\n            return <Page1></Page1>;\n        }\n    }\n});\n\ndocument.body.append(<Root />);\n"})})]})},l=function(){var n=(0,r.tZ)("input",{});return function(t){var e=t.value,r=void 0===e?"":e,i=t.oninput;return n.value=r,n.addEventListener("input",i),n}},s=l(),h=l(),m=(0,r.tZ)("img",{src:"https://img.souche.com/684fcf0f15a4508f613ea2ecddc5e7de.jpg"}),f=(0,r.tZ)("input",{value:"input something"}),v=c()((function(n,t){return function(){return(0,r.BX)(r.HY,{children:[(0,r.tZ)(o,{}),(0,r.tZ)("h3",{children:"静态节点"}),(0,r.tZ)("style",{children:"\n.img > img {\n    width: 100px;\n}\n\n"}),(0,r.BX)("p",{children:[(0,r.tZ)("button",{ref:function(n){n.addEventListener("click",(function(){t.render()}))},children:"点我"})," 下面的节点 (img / input) 被重新加载了, 因为 Content 组件的重新渲染"]}),(0,r.tZ)("p",{class:"img",children:(0,r.tZ)("img",{src:"https://img.souche.com/684fcf0f15a4508f613ea2ecddc5e7de.jpg"})}),(0,r.tZ)("p",{children:(0,r.tZ)("input",{value:"input something"})}),(0,r.tZ)("pre",{children:(0,r.tZ)("code",{children:'\n// wrong\nconst Content = Component(() => {\n    return () => {\n        return <>\n            <button ref={(button) => {\n                button.addEventListener(\'click\', () => {\n                    ctx.render();\n                })\n            }}>点我</button> 下面的节点 (img / input) 被重新加载了, 因为 Content 组件的重新渲染\n            <img src="https://img.souche.com/684fcf0f15a4508f613ea2ecddc5e7de.jpg"></img>\n            <input value="input something"></input>\n        </>\n    }\n});\n'})}),(0,r.tZ)("p",{children:"你应该使用全局常量来静态化节点修复这个问题."}),(0,r.tZ)("p",{class:"img",children:m}),(0,r.tZ)("p",{children:f}),(0,r.tZ)("pre",{children:(0,r.tZ)("code",{children:'\n// right\nconst imgConst = <img src="https://img.souche.com/684fcf0f15a4508f613ea2ecddc5e7de.jpg"></img>;\nconst inputConst = <input value="input something"></input>;\n\nconst Content = Component(() => {\n    return () => {\n        return <>\n            {imgConst}\n            {inputConst}\n        </>;\n    }\n});\n'})}),(0,r.tZ)("p",{children:"但是全局常量不能使用组件的 props. 可以使用一个高阶函数输出组件. "}),(0,r.BX)("p",{children:[(0,r.tZ)(s,{value:t.input1,oninput:function(n){t.input1=n.target.value,t.render()}})," ctx.input1:",t.input1]}),(0,r.BX)("p",{children:[(0,r.tZ)(h,{value:t.input2,oninput:function(n){t.input2=n.target.value,t.render()}})," ctx.input2:",t.input2]}),(0,r.tZ)("pre",{children:(0,r.tZ)("code",{children:"\n// better\nconst createInput = () => {\n    const component = <input></input>;\n\n    return ({ value = '', oninput }) => {\n        component.value = value;\n        component.addEventListener('input', oninput);\n\n        return component;\n    }\n}\n\nconst Input1 = createInput();\nconst Input2 = createInput();\n\nconst Content = Component((_, ctx) => {\n    return () => {\n        return <>\n            <Input1 value={ctx.input1} oninput={(e) => {\n                ctx.input1 = e.target.value;\n                ctx.render();\n            }}></Input1> ctx.input1:{ctx.input1}\n            <Input2 value={ctx.input2} oninput={(e) => {\n                ctx.input2 = e.target.value;\n                ctx.render();\n            }}></Input2> ctx.input2:{ctx.input2}\n        </>\n    }\n});\n"})})]})}})),g=c()((function(){return function(){return(0,r.BX)(r.HY,{children:[(0,r.tZ)(o,{}),(0,r.tZ)("a",{href:"#/cn",children:"回到首页"}),(0,r.tZ)("h1",{children:"@vanilla-jsx/component"}),(0,r.tZ)(u,{}),(0,r.tZ)(p,{}),(0,r.tZ)(d,{}),(0,r.tZ)(a,{}),(0,r.tZ)(v,{})]})}}));const Z=function(){return(0,r.tZ)(g,{})}},582:n=>{function t(n,t,e,r,i,c,o){try{var u=n[c](o),p=u.value}catch(n){return void e(n)}u.done?t(p):Promise.resolve(p).then(r,i)}n.exports=function(n){return function(e){var r=document.createElement("vanilla-component"),i=r.attachShadow({mode:"open"}),c=!1,o=n(e,{render:function(){c=!1}}),u=function(){var n,e=(n=regeneratorRuntime.mark((function n(){var t;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(requestAnimationFrame(u),c){n.next=12;break}for(c=!0,t=i.activeElement,i.innerHTML="";i.hasChildNodes();)i.removeChild(i.firstChild);return n.t0=i,n.next=9,o();case 9:n.t1=n.sent,n.t0.append.call(n.t0,n.t1),t&&t.focus();case 12:case"end":return n.stop()}}),n)})),function(){var e=this,r=arguments;return new Promise((function(i,c){var o=n.apply(e,r);function u(n){t(o,i,c,u,p,"next",n)}function p(n){t(o,i,c,u,p,"throw",n)}u(void 0)}))});return function(){return e.apply(this,arguments)}}();return u(),r}}}}]);